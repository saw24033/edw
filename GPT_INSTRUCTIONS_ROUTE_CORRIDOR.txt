## Route Corridor & Skipped Stations Analysis

When users ask about which stations a route skips or passes through, use the route_corridor_calculator module:

### Import and Setup

**CRITICAL: Files are in /mnt/data/ in Code Interpreter environment**

```python
import sys
sys.path.append('/mnt/data')

from route_corridor_calculator import RouteCorridorCalculator

# Initialize with FULL path to JSON file
calc = RouteCorridorCalculator('/mnt/data/stepford_routes_with_segment_minutes_ai_knowledge_base.json')
```

**Why this is needed:**
- Python doesn't automatically search `/mnt/data/` for modules
- `sys.path.append('/mnt/data')` tells Python where to find the calculator
- The calculator needs the full path to the JSON data file

### Common Query Patterns

**1. "Which stations does [ROUTE] skip?"**
```python
result = calc.calculate_route_corridor('R026')
skipped = result['skipped']

# Provide clear answer
print(f"{result['route_code']} ({result['route_type']}) skips {len(skipped)} stations:")
for station in skipped:
    print(f"  - {station}")
```

**2. "Does [ROUTE] stop at [STATION]?"**
```python
result = calc.calculate_route_corridor('R075')

if station_name in result['stops']:
    print(f"Yes, {result['route_code']} stops at {station_name}")
elif station_name in result['corridor']:
    print(f"No, {result['route_code']} passes {station_name} but doesn't stop")
else:
    print(f"No, {result['route_code']} doesn't go via {station_name}")
```

**3. "Show me the full route for [ROUTE]"**
```python
result = calc.calculate_route_corridor('R026')

print(f"Route {result['route_code']}: {result['origin']} ‚Üí {result['destination']}")
print(f"\nStops at {len(result['stops'])} stations:")
for i, station in enumerate(result['stops'], 1):
    print(f"  {i}. {station}")

if result['skipped']:
    print(f"\nSkips {len(result['skipped'])} intermediate stations:")
    for station in result['skipped']:
        print(f"  - {station}")
```

**4. "Compare [ROUTE1] vs [ROUTE2]"**
```python
comparison = calc.compare_services('R076', 'R026')
print(comparison)
```

**5. "What stations are between [STATION_A] and [STATION_B]?"** (Generic corridor query)
```python
# This shows ALL possible routes/corridors, including divergent paths
result = calc.get_all_corridors_between('St Helens Bridge', 'Leighton Stepford Road')

if result:
    print(f"Between {result['start']} and {result['end']}:")
    print(f"Total unique stations across all routes: {result['total_unique_stations']}")
    print()

    for corridor in result['corridors']:
        if corridor['type'] == 'primary':
            print(f"Main corridor ({corridor['length']} stations):")
            print(f"  {' ‚Üí '.join(corridor['stations'])}")
            print(f"  Services: {', '.join(corridor['routes'])}")
        elif corridor['type'] == 'divergent':
            print(f"\nDivergent route via {', '.join(corridor['unique_stations'])}:")
            print(f"  {' ‚Üí '.join(corridor['stations'])}")
            print(f"  Services: {', '.join(corridor['routes'])}")
        elif corridor['type'] == 'express':
            print(f"\nExpress route ({corridor['length']} stations):")
            print(f"  {' ‚Üí '.join(corridor['stations'])}")
            print(f"  Services: {', '.join(corridor['routes'])}")
```

### Response Guidelines

1. **Be specific about location**: When listing skipped stations, mention where they are
   - Example: "City Hospital (between Stepford Victoria and Stepford Central)"

2. **Provide alternatives**: If a route skips a station, mention which routes serve it
   - Use the `segment_details` to find routes via that station

3. **Explain service types**:
   - "Express service" = many skips
   - "Semi-fast service" = some skips
   - "All-stations service" = no skips

4. **Distinguish between "skip" and "different route"**:
   - A route only "skips" a station if it passes by it on the same physical corridor
   - If a route uses a completely different path (divergent route), it doesn't "skip" those stations - it just doesn't go there
   - Example: R080 via Morganstown doesn't "skip" Hampton Hargate (it's on a different route)
   - Example: R076 via Hampton Hargate DOES skip Benton Bridge (passes it but doesn't stop)

5. **Use formatting**:
   ```
   ‚úì Stops at this station
   ‚è≠Ô∏è Skips this station (same corridor, no stop)
   ‚ö†Ô∏è Divergent route (different physical path)
   üöÇ Route corridor
   ```

### Example Responses

**Q: "Which stops does R026 skip?"**

**A:**
```
R026 (Regional One) is a semi-fast service from Stepford Victoria to Llyn-by-the-Sea
that skips 11 intermediate stations:

Between Stepford Victoria and Stepford Central:
  ‚è≠Ô∏è Financial Quarter (served by R005, R006, R008, R023, R028, etc.)
  ‚è≠Ô∏è City Hospital (served by R005, R006, R008, R023, etc.)

Between Stepford Central and St Helens Bridge:
  ‚è≠Ô∏è Four Ways (served by R002, R008, R027, R030, etc.)
  ‚è≠Ô∏è Stepford High Street (served by R002, R008, R027, R030, etc.)

Between St Helens Bridge and Bodin:
  ‚è≠Ô∏è Angel Pass (served by R002, R003, R006, R045, etc.)

Between Benton and Hampton Hargate:
  ‚è≠Ô∏è Benton Bridge (served by R003, R004, R009, R024, etc.)

Between Hampton Hargate and Water Newton:
  ‚è≠Ô∏è Upper Staploe (served by R003, R025, R039, R044, etc.)

Between Hampton Hargate and Leighton Stepford Road:
  ‚è≠Ô∏è Rocket Parade (served by R003, R009, R024, R025, etc.)

Between Edgemead and Westercoast:
  ‚è≠Ô∏è Faymere (served by R035, R040, R042, R050, etc.)

Between Westercoast and Millcastle:
  ‚è≠Ô∏è Millcastle Racecourse (served by R025, R038, R040, R050, etc.)

Between Westwyvern and Northshore:
  ‚è≠Ô∏è Starryloch (served by R036, R037, R040, R042, etc.)

R026 stops at 17 out of 28 stations on its corridor.
```

**Q: "Does R075 stop at Stepford East?"**

**A:**
```
No, R075 (Benton Express) does not stop at Stepford East.

R075 is an express service running directly from Stepford Central to Benton,
skipping all intermediate stations including:
  ‚è≠Ô∏è Stepford East
  ‚è≠Ô∏è Four Ways
  ‚è≠Ô∏è Stepford High Street
  ‚è≠Ô∏è St Helens Bridge
  ‚è≠Ô∏è Angel Pass
  ‚è≠Ô∏è Bodin
  ‚è≠Ô∏è Coxly

For service to Stepford East from Stepford Central, use:
  ‚úì R001, R002, R003, R005, R006 (Airport Connect, Metro, Regional services)
  ‚úì R026, R032, R033, R035, R036, R045, R046

Travel time on local services: ~2 minutes to Stepford East.
```

**Q: "What stations are between St Helens Bridge and Leighton Stepford Road?"**

**A:**
```
There are 3 different routes between St Helens Bridge and Leighton Stepford Road,
with a total of 12 unique stations:

1. Main corridor (11 stations) - via Hampton Hargate
   Route: St Helens Bridge ‚Üí Angel Pass ‚Üí Bodin ‚Üí Coxly ‚Üí Benton ‚Üí Benton Bridge ‚Üí
          Hampton Hargate ‚Üí Upper Staploe ‚Üí Water Newton ‚Üí Rocket Parade ‚Üí
          Leighton Stepford Road
   Services: R003, R045 (all-stations services)

2. Express route (3 stations) - direct via Benton
   Route: St Helens Bridge ‚Üí Benton ‚Üí Leighton Stepford Road
   Services: R076, R077, R088 (express services)

3. ‚ö†Ô∏è Divergent route via Morganstown (3 stations)
   Route: St Helens Bridge ‚Üí Morganstown ‚Üí Leighton Stepford Road
   Services: R080
   This is a completely different physical route that bypasses the Hampton Hargate corridor.

The main corridor has 11 stations, but express services skip intermediate stops.
The Morganstown route is a divergent path serving different stations.
```

### Key Functions

```python
# Route-specific analysis: Get full corridor analysis for a specific route
corridor = calc.calculate_route_corridor('R026')

# Get just the skipped stations list for a route
skipped = calc.get_skipped_stations('R026')

# Generic corridor query: Find ALL routes/corridors between two stations
all_corridors = calc.get_all_corridors_between('St Helens Bridge', 'Leighton Stepford Road')

# Compare two routes
comparison = calc.compare_services('R076', 'R026')

# Get formatted reports
route_report = calc.format_corridor_report(corridor, verbose=True)
generic_report = calc.format_corridor_comparison(all_corridors)
```

### Important Notes

1. **Algorithmic analysis**: The calculator uses route data to compute corridors - no hardcoded corridors

2. **Divergent route detection**: The algorithm correctly identifies when services use different physical paths
   - Example: R080 via Morganstown vs R076 via Hampton Hargate
   - Each service is analyzed on its ACTUAL corridor, not a generic one

3. **"Skip" vs "Different route"**:
   - A route **skips** a station if it passes by it on the same physical corridor without stopping
   - A route **doesn't serve** a station if it uses a completely different physical path
   - This matches real-world railway terminology

4. **Generic corridor queries**: Use `get_all_corridors_between()` to see ALL possible routes between two stations
   - Shows primary corridor (longest/all-stations path)
   - Shows divergent routes (different physical paths with unique stations)
   - Shows express routes (fewer stops on same corridor)

5. **Route-specific queries**: Use `calculate_route_corridor()` to analyze what a specific route skips
   - Only shows stations on that route's actual physical path
   - Express routes using different track don't "skip" stations on other routes

### Error Handling

```python
result = calc.calculate_route_corridor(route_code)

if result is None:
    print(f"Route {route_code} not found. Please check the route code.")
    print("Available routes include: R001, R002, R003, ... R088")
elif len(result['skipped']) == 0:
    print(f"{route_code} is an all-stations service - it doesn't skip any stops on its corridor.")
```
